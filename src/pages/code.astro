---
import Layout from "../layouts/Layout.astro";
import NavBar from "../components/NavBar.tsx";
import { getCollection } from 'astro:content';

export const prerender = true;

// Get all code projects, sorted by date (newest first)
const codeProjects = await getCollection('code');
const sortedCodeProjects = codeProjects.sort((a, b) =>
    new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Group projects by category
const projectsByCategory = sortedCodeProjects.reduce((acc, project) => {
    const category = project.data.category || 'other';
    if (!acc[category]) acc[category] = [];
    acc[category].push(project);
    return acc;
}, {} as Record<string, typeof sortedCodeProjects>);

const categoryLabels = {
    web: 'Web Applications',
    mobile: 'Mobile Apps',
    desktop: 'Desktop Software',
    library: 'Libraries & Tools',
    tool: 'Developer Tools',
    other: 'Other Projects'
};
---

<Layout>
    <div class="min-h-screen flex flex-col">
        <NavBar client:load />

        <h3 class="text-center text-4xl font-bold my-8">CODE</h3>

        <!-- Desktop Layout -->
        <div class="hidden md:flex flex-1 max-w-7xl mx-auto w-full">
            <!-- About Section -->
            <div class="w-1/2 flex flex-col justify-center p-8">
                <h2 class="text-3xl font-bold mb-6">About My Development</h2>
                <p class="text-gray-300 text-lg mb-8">
                    I specialize in building modern web applications and tools that solve real-world problems.
                    My focus is on clean, efficient code and exceptional user experiences.
                </p>

                <div class="space-y-6">
                    <div>
                        <h3 class="text-xl font-semibold mb-3">Frontend</h3>
                        <div class="flex flex-wrap gap-2">
                            {['React', 'TypeScript', 'Astro', 'Next.js', 'Tailwind CSS'].map(tech => (
                                    <span key={tech} class="bg-gray-800 text-gray-300 px-3 py-1 rounded-full text-sm border border-gray-600">
                                    {tech}
                                </span>
                            ))}
                        </div>
                    </div>

                    <div>
                        <h3 class="text-xl font-semibold mb-3">Backend & Database</h3>
                        <div class="flex flex-wrap gap-2">
                            {['Node.js', 'Python', 'PostgreSQL', 'MongoDB', 'Redis'].map(tech => (
                                    <span key={tech} class="bg-gray-800 text-gray-300 px-3 py-1 rounded-full text-sm border border-gray-600">
                                    {tech}
                                </span>
                            ))}
                        </div>
                    </div>

                    <div>
                        <h3 class="text-xl font-semibold mb-3">Cloud & DevOps</h3>
                        <div class="flex flex-wrap gap-2">
                            {['AWS', 'Docker', 'Cloudflare', 'Vercel', 'GitHub Actions'].map(tech => (
                                    <span key={tech} class="bg-gray-800 text-gray-300 px-3 py-1 rounded-full text-sm border border-gray-600">
                                    {tech}
                                </span>
                            ))}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scrollable Projects -->
            <div class="w-1/2 p-8">
                <div class="h-[calc(100vh-16rem)] overflow-y-auto pr-4 custom-scrollbar">
                    <div class="space-y-8">
                        {Object.entries(projectsByCategory).map(([category, projects]) => (
                                <section key={category}>
                                    <h3 class="text-xl font-semibold mb-4 text-white border-b border-gray-700 pb-2">
                                        {categoryLabels[category as keyof typeof categoryLabels] || category}
                                    </h3>
                                    <div class="space-y-4">
                                        {projects.map((project) => (
                                                <article key={project.slug} class="bg-zinc-900 rounded-lg p-6 border border-gray-700 hover:border-gray-500 transition-all duration-300 group">
                                                    <div class="flex items-start justify-between mb-4">
                                                        <div class="flex-1">
                                                            <h4 class="text-lg font-semibold mb-2 group-hover:text-white transition-colors">
                                                                <a href={`/code/${project.slug}`}>{project.data.title}</a>
                                                            </h4>
                                                            <p class="text-gray-400 text-sm mb-2">
                                                                {project.data.date.toLocaleDateString('en-US', {
                                                                    year: 'numeric',
                                                                    month: 'long',
                                                                    day: 'numeric'
                                                                })}
                                                            </p>
                                                        </div>
                                                        <span class={`text-xs px-2 py-1 rounded-full border ${
                                                            project.data.status === 'completed'
                                                                ? 'bg-green-900/30 text-green-300 border-green-700'
                                                                : project.data.status === 'in-progress'
                                                                    ? 'bg-yellow-900/30 text-yellow-300 border-yellow-700'
                                                                    : 'bg-gray-800 text-gray-400 border-gray-600'
                                                        }`}>
                                                    {project.data.status}
                                                </span>
                                                    </div>

                                                    <p class="text-gray-300 mb-4">{project.data.description}</p>

                                                    {project.data.tech && (
                                                            <div class="flex flex-wrap gap-1 mb-4">
                                                                {project.data.tech.slice(0, 4).map((tech: string) => (
                                                                        <span key={tech} class="text-xs bg-gray-800 text-gray-300 px-2 py-1 rounded border border-gray-600">
                                                            {tech}
                                                        </span>
                                                                ))}
                                                                {project.data.tech.length > 4 && (
                                                                        <span class="text-xs bg-gray-800 text-gray-400 px-2 py-1 rounded border border-gray-600">
                                                            +{project.data.tech.length - 4} more
                                                        </span>
                                                                )}
                                                            </div>
                                                    )}

                                                    <div class="flex gap-2">
                                                        <a
                                                                href={`/code/${project.slug}`}
                                                                class="px-4 py-2 bg-white text-black hover:bg-gray-200 rounded-lg transition-colors text-sm font-medium"
                                                        >
                                                            Details
                                                        </a>
                                                        {project.data.liveUrl && (
                                                                <a
                                                                        href={project.data.liveUrl}
                                                                        target="_blank"
                                                                        class="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors text-sm flex items-center gap-1 border border-gray-600"
                                                                >
                                                                    Live
                                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                                                    </svg>
                                                                </a>
                                                        )}
                                                        {project.data.githubUrl && (
                                                                <a
                                                                        href={project.data.githubUrl}
                                                                        target="_blank"
                                                                        class="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors text-sm flex items-center gap-1 border border-gray-600"
                                                                >
                                                                    GitHub
                                                                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                                                                        <path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
                                                                    </svg>
                                                                </a>
                                                        )}
                                                    </div>
                                                </article>
                                        ))}
                                    </div>
                                </section>
                        ))}
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Layout -->
        <div class="md:hidden px-4 pb-6 space-y-6">
            <!-- About section -->
            <div class="bg-gray-900 rounded-lg p-6 border border-gray-700">
                <h2 class="text-2xl font-bold mb-4">About My Development</h2>
                <p class="text-gray-300 mb-4">
                    I specialize in building modern web applications and tools that solve real-world problems.
                </p>
                <div class="flex flex-wrap gap-2">
                    {['React', 'TypeScript', 'Node.js', 'Python'].map(tech => (
                            <span key={tech} class="bg-gray-800 text-gray-300 px-2 py-1 rounded-full text-xs border border-gray-600">
                            {tech}
                        </span>
                    ))}
                </div>
            </div>

            <!-- Mobile Projects by Category -->
            {Object.entries(projectsByCategory).map(([category, projects]) => (
                    <section key={category}>
                        <h3 class="text-lg font-semibold mb-3 text-white">
                            {categoryLabels[category as keyof typeof categoryLabels] || category}
                        </h3>
                        <div class="space-y-3">
                            {projects.map((project) => (
                                    <article key={project.slug} class="bg-zinc-900 rounded-lg p-4 border border-gray-700">
                                        <div class="flex items-start justify-between mb-3">
                                            <h4 class="text-base font-semibold">
                                                <a href={`/code/${project.slug}`} class="hover:text-white transition-colors">
                                                    {project.data.title}
                                                </a>
                                            </h4>
                                            <span class={`text-xs px-2 py-1 rounded-full border ${
                                                project.data.status === 'completed'
                                                    ? 'bg-green-900/30 text-green-300 border-green-700'
                                                    : project.data.status === 'in-progress'
                                                        ? 'bg-yellow-900/30 text-yellow-300 border-yellow-700'
                                                        : 'bg-gray-800 text-gray-400 border-gray-600'
                                            }`}>
                                        {project.data.status}
                                    </span>
                                        </div>

                                        <p class="text-gray-400 text-sm mb-2">
                                            {project.data.date.toLocaleDateString()}
                                        </p>

                                        <p class="text-gray-300 text-sm mb-3">{project.data.description}</p>

                                        {project.data.tech && (
                                                <div class="flex flex-wrap gap-1 mb-3">
                                                    {project.data.tech.slice(0, 3).map((tech: string) => (
                                                            <span key={tech} class="text-xs bg-gray-800 text-gray-300 px-2 py-1 rounded border border-gray-600">
                                                {tech}
                                            </span>
                                                    ))}
                                                </div>
                                        )}

                                        <div class="flex gap-2">
                                            <a
                                                    href={`/code/${project.slug}`}
                                                    class="px-3 py-1 bg-white text-black hover:bg-gray-200 rounded text-sm font-medium transition-colors"
                                            >
                                                Details
                                            </a>
                                            {project.data.liveUrl && (
                                                    <a
                                                            href={project.data.liveUrl}
                                                            target="_blank"
                                                            class="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded text-sm transition-colors border border-gray-600"
                                                    >
                                                        Live
                                                    </a>
                                            )}
                                            {project.data.githubUrl && (
                                                    <a
                                                            href={project.data.githubUrl}
                                                            target="_blank"
                                                            class="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded text-sm transition-colors border border-gray-600"
                                                    >
                                                        Code
                                                    </a>
                                            )}
                                        </div>
                                    </article>
                            ))}
                        </div>
                    </section>
            ))}
        </div>
    </div>

    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #262626;
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #404040;
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #525252;
        }
    </style>
</Layout>